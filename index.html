<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Morikawa NY 2026</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; padding:0; background:#0b0e1a; color:white; font-family:'Noto Sans JP',sans-serif; overflow:hidden; }
    #snow { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    .container { position:relative; z-index:10; text-align:center; padding:20px; }
    h1 { font-size:28px; margin:20px 0; text-shadow:0 0 10px #ff69b4; }
    .countdown { font-size:24px; margin:30px 0; color:#ff69b4; }
    #game { width:300px; height:300px; margin:20px auto; position:relative; background:rgba(0,0,0,0.3); border-radius:20px; overflow:hidden; }
    .kadzyun { position:absolute; width:60px; height:60px; background:url('https://i.imgur.com/0Z9kZ0j.png') center/cover; cursor:pointer; }
    .score { font-size:22px; margin:10px; }
    .buttons { margin:30px 0; }
    button { background:#ff1493; border:none; color:white; padding:15px 25px; margin:10px; border-radius:12px; font-size:18px; cursor:pointer; }
    button:hover { background:#ff69b4; }
    .top { margin:20px; font-size:18px; }
  </style>
</head>
<body>
  <canvas id="snow"></canvas>
  <div class="container">
    <h1>üå∏ Morikawa<br>–ù–æ–≤—ã–π –≥–æ–¥ 2026 ‚õ©Ô∏è</h1>
    <div class="countdown" id="countdown"></div>
    <p>–ü–æ–π–º–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∫–∞–¥–∑—é–Ω–æ–≤! üßß</p>
    <div class="score">–û—á–∫–∏: <span id="score">0</span></div>
    <div id="game"></div>
    <div class="top" id="top">–¢–æ–ø —Å–µ–≥–æ–¥–Ω—è: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
    
    <div class="buttons">
      <button onclick="Telegram.WebApp.openLink('https://forms.gle/BE1kb2Hk94wk6ph87')">üéç –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ –≥–æ—Ä–æ–¥</button><br>
      <button onclick="copyCoords()">üìç –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—Ä–æ–∑–æ–≤–∞—è 1700)</button><br>
      <button onclick="Telegram.WebApp.close()">‚ú® –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –°–Ω–µ–≥ + –ª–µ–ø–µ—Å—Ç–∫–∏ —Å–∞–∫—É—Ä—ã
    const canvas = document.getElementById('snow');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];
    for(let i=0; i<100; i++) {
      particles.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*4+1,
        d: Math.random()*100,
        type: Math.random() > 0.7 ? 'sakura' : 'snow'
      });
    }
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.beginPath();
      for(let i=0; i<particles.length; i++) {
        let p = particles[i];
        if(p.type === 'sakura') {
          ctx.fillStyle = '#ff69b4';
          ctx.fillRect(p.x, p.y, p.r*2, p.r*3);
        } else {
          ctx.moveTo(p.x, p.y);
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fill();
        }
        p.y += p.r/2;
        if(p.y > canvas.height) p.y = 0;
        p.x += Math.sin(p.d/10);
      }
      requestAnimationFrame(draw);
    }
    draw();

    // –û—Ç—Å—á—ë—Ç
    function updateCountdown() {
      const now = new Date();
      const ny = new Date('2026-01-01T00:00:00');
      const diff = ny - now;
      if(diff <= 0) {
        document.getElementById('countdown').innerHTML = 'üéâ –° –ù–æ–≤—ã–º 2026 –≥–æ–¥–æ–º! üéâ';
        return;
      }
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const mins = Math.floor((diff % (1000*60*60)) / (1000*60));
      const secs = Math.floor((diff % (1000*60)) / 1000);
      document.getElementById('countdown').innerHTML = 
        `${days}–¥ ${hours}—á ${mins}–º ${secs}—Å –¥–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞! üéÜ`;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    // –ú–∏–Ω–∏-–∏–≥—Ä–∞
    let score = 0;
    const game = document.getElementById('game');
    function spawn() {
      const k = document.createElement('div');
      k.className = 'kadzyun';
      k.style.left = Math.random()*240 + 'px';
      k.style.top = Math.random()*240 + 'px';
      k.onclick = () => {
        score += 10;
        document.getElementById('score').textContent = score;
        saveScore();
        k.remove();
      };
      game.appendChild(k);
      setTimeout(() => k.remove(), 3000);
    }
    setInterval(spawn, 800);

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Ç–æ–ø (localStorage + –∏–º–∏—Ç–∞—Ü–∏—è)
    function saveScore() {
      const user = Telegram.WebApp.initDataUnsafe.user?.first_name || '–ê–Ω–æ–Ω–∏–º';
      const today = new Date().toDateString();
      let top = JSON.parse(localStorage.getItem('morikawa_ny_top') || '{}');
      if(!top[today]) top[today] = [];
      top[today].push({name: user, score: score});
      top[today].sort((a,b)=>b.score-a.score);
      top[today] = top[today].slice(0,5);
      localStorage.setItem('morikawa_ny_top', JSON.stringify(top));
      updateTop();
    }
    function updateTop() {
      const today = new Date().toDateString();
      let top = JSON.parse(localStorage.getItem('morikawa_ny_top') || '{}');
      const list = top[today] || [];
      document.getElementById('top').innerHTML = '<strong>üèÜ –¢–æ–ø —Å–µ–≥–æ–¥–Ω—è:</strong><br>' + 
        (list.length ? list.map((p,i)=>`${i+1}. ${p.name} ‚Äî ${p.score}`).join('<br>') : '–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–ª!');
    }
    updateTop();

    function copyCoords() {
      navigator.clipboard.writeText('—Ä–æ–∑–æ–≤–∞—è –≤–µ—Ç–∫–∞:1700');
      Telegram.WebApp.showAlert('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
    }
  </script>
</body>
</html>
