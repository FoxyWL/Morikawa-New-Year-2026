<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Morikawa NY 2026</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; padding:0; background:linear-gradient(#0b0e1a, #1a1f3a); color:white; font-family:'Noto Sans JP',sans-serif; overflow:hidden; }
    #snow { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    .container { position:relative; z-index:10; text-align:center; padding:20px; display:none; }
    .active { display:block; }
    h1 { font-size:28px; margin:20px 0; text-shadow:0 0 15px #ff69b4; color:#ff1493; }
    .countdown { font-size:24px; margin:30px 0; color:#ff69b4; }
    #game { width:300px; height:300px; margin:20px auto; position:relative; background:rgba(255,105,180,0.1); border-radius:20px; overflow:hidden; border:2px solid #ff69b4; }
    .kadzyun { position:absolute; width:60px; height:60px; background:url('https://i.imgur.com/0Z9kZ0j.png') center/cover; cursor:pointer; animation:fadeIn 0.5s; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    .score { font-size:22px; margin:10px; color:#ffd700; }
    .buttons { margin:30px 0; }
    button { background:#ff1493; border:none; color:white; padding:15px 25px; margin:10px; border-radius:12px; font-size:18px; cursor:pointer; box-shadow:0 0 10px #ff69b4; transition:0.3s; }
    button:hover { background:#ff69b4; transform:scale(1.05); }
    .top { margin:20px; font-size:18px; background:rgba(0,0,0,0.5); padding:10px; border-radius:10px; }
    nav { position:fixed; bottom:0; width:100%; background:#0b0e1a; padding:10px; text-align:center; z-index:20; }
    nav button { margin:5px; padding:10px 20px; font-size:16px; }

    /* –õ–∏–¥–µ—Ä–±–æ—Ä–¥ */
    #leaderboard ul { list-style:none; padding:0; }
    #leaderboard li { background:rgba(255,105,180,0.2); margin:10px; padding:10px; border-radius:10px; }

    /* –ö–µ–π—Å—ã –∏ –∞–Ω–∏–º–∞—Ü–∏—è */
    #case-button { background:#ff1493; padding:20px; font-size:24px; border-radius:20px; box-shadow:0 0 20px #ff69b4; }
    #case-model { width:200px; height:200px; margin:20px auto; background:url('https://static.vecteezy.com/system/resources/previews/000/226/725/original/vector-red-japanese-envelope-with-sakura-branch.jpg') center/cover; cursor:pointer; transition:0.3s; }
    #case-model.opening { animation: shakeOpen 2s ease-in-out; }
    @keyframes shakeOpen {
      0% { transform: rotate(0); }
      10% { transform: rotate(-5deg); }
      20% { transform: rotate(5deg); }
      30% { transform: rotate(-5deg); }
      40% { transform: rotate(5deg); scale(1.1); }
      60% { transform: rotate(0) scale(1.2); opacity:0.8; }
      100% { transform: rotate(0) scale(1); opacity:1; }
    }
    #drop-animation { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:300px; height:400px; display:none; z-index:30; animation:revealCard 1s ease-out; }
    @keyframes revealCard { from {opacity:0; transform:scale(0.5);} to {opacity:1; transform:scale(1);} }
    .card-display { width:100%; height:100%; background:#333; border:5px solid gold; border-radius:20px; padding:20px; text-align:center; box-shadow:0 0 30px #ffd700; position:relative; overflow:hidden; }
    .rarity-common { border-color:#bbb; }
    .rarity-rare { border-color:#00ff00; }
    .rarity-epic { border-color:#ff00ff; }
    .card-img { width:200px; height:200px; object-fit:cover; border-radius:15px; margin:20px 0; }
    #collection { display:grid; grid-template-columns:repeat(auto-fill, minmax(150px,1fr)); gap:10px; margin:20px; }
    .collected-card { width:150px; height:200px; background-size:cover; border-radius:10px; opacity:0.7; }
    .collected-card.owned { opacity:1; box-shadow:0 0 15px gold; }
    /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ (–ø—Ä–æ—Å—Ç–æ–π —ç—Ñ—Ñ–µ–∫—Ç) */
    .confetti { position:absolute; width:10px; height:10px; background:#ff69b4; animation:confettiFall 2s linear infinite; }
    @keyframes confettiFall { 0% {transform:translateY(-100%) rotate(0);} 100% {transform:translateY(200%) rotate(360deg);} }
  </style>
</head>
<body>
  <canvas id="snow"></canvas>

  <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
  <div id="home" class="container active">
    <h1>üå∏ Morikawa<br>–ù–æ–≤—ã–π –≥–æ–¥ 2026 ‚õ©Ô∏è</h1>
    <div class="countdown" id="countdown"></div>
    <p>–ü–æ–π–º–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∫–∞–¥–∑—é–Ω–æ–≤! üßß</p>
    <div class="score">–û—á–∫–∏: <span id="score">0</span></div>
    <div id="game"></div>
    <div class="top" id="top">–¢–æ–ø —Å–µ–≥–æ–¥–Ω—è: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
    <div class="buttons">
      <button onclick="Telegram.WebApp.openLink('https://forms.gle/BE1kb2Hk94wk6ph87')">üéç –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ –≥–æ—Ä–æ–¥</button><br>
      <button onclick="copyCoords()">üìç –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button><br>
      <button onclick="Telegram.WebApp.showPopup({message:'–ü–æ–¥–µ–ª–∏—Å—å —Å –¥—Ä—É–∑—å—è–º–∏!', buttons:[{type:'share', url:'t.me/morikawa_tg'}]})">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ TG</button><br>
      <button onclick="Telegram.WebApp.close()">‚ú® –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
  <div id="leaderboard" class="container">
    <h1>üèÜ –õ–∏–¥–µ—Ä—ã –ø–æ –Ω–∏–∫–∞–º TG</h1>
    <ul id="leader-list"></ul>
    <button onclick="switchPage('home')">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ö–µ–π—Å—ã/–ö–∞—Ä—Ç–æ—á–∫–∏ -->
  <div id="cards" class="container">
    <h1>üé≤ –ö–µ–π—Å—ã —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤ Morikawa</h1>
    <p>–û—Ç–∫—Ä—ã–≤–∞–π –∫–µ–π—Å ‚Äî —Å–æ–±–∏—Ä–∞–π –∫–æ–ª–ª–µ–∫—Ü–∏—é —Ç–æ–ø-–∂–∏—Ç–µ–ª–µ–π! (1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≤ –¥–µ–Ω—å)</p>
    <div id="case-model" onclick="openCase()"></div> <!-- –ú–æ–¥–µ–ª—å –∫–µ–π—Å–∞ -->
    <p id="daily-info"></p>

    <div id="drop-animation">
      <div class="card-display" id="dropped-card">
        <h2 id="card-name"></h2>
        <div id="card-rarity" style="font-size:18px; margin:10px;"></div>
        <img id="card-image" class="card-img">
        <p id="card-desc"></p>
        <button onclick="closeDrop()">–ó–∞–±—Ä–∞—Ç—å!</button>
      </div>
    </div>

    <h2>–¢–≤–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è (<span id="collected-count">0</span>/<span id="total-count">0</span>)</h2>
    <div id="collection"></div>

    <button onclick="switchPage('home')">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav>
    <button onclick="switchPage('home')">–ì–ª–∞–≤–Ω–∞—è</button>
    <button onclick="switchPage('leaderboard')">–õ–∏–¥–µ—Ä—ã</button>
    <button onclick="switchPage('cards')">–ö–∞—Ä—Ç–æ—á–∫–∏</button>
  </nav>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –°–Ω–µ–≥ + –ª–µ–ø–µ—Å—Ç–∫–∏ —Å–∞–∫—É—Ä—ã
    const canvas = document.getElementById('snow');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];
    for(let i=0; i<150; i++) {
      particles.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*5+1,
        d: Math.random()*150,
        type: Math.random() > 0.6 ? 'sakura' : 'snow'
      });
    }
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.beginPath();
      for(let i=0; i<particles.length; i++) {
        let p = particles[i];
        if(p.type === 'sakura') {
          ctx.fillStyle = '#ff69b4';
          ctx.fillRect(p.x, p.y, p.r*2.5, p.r*3.5);
        } else {
          ctx.moveTo(p.x, p.y);
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fill();
        }
        p.y += p.r/1.5;
        if(p.y > canvas.height) p.y = 0;
        p.x += Math.sin(p.d/10);
      }
      requestAnimationFrame(draw);
    }
    draw();

    // –û—Ç—Å—á—ë—Ç
    function updateCountdown() {
      const now = new Date();
      const ny = new Date('2026-01-01T00:00:00');
      const diff = ny - now;
      if(diff <= 0) return document.getElementById('countdown').innerHTML = 'üéâ –° –ù–æ–≤—ã–º 2026 –≥–æ–¥–æ–º! üéâ';
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const mins = Math.floor((diff % (1000*60*60)) / (1000*60));
      const secs = Math.floor((diff % (1000*60)) / 1000);
      document.getElementById('countdown').innerHTML = `${days}–¥ ${hours}—á ${mins}–º ${secs}—Å –¥–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞! üéÜ`;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    // –ú–∏–Ω–∏-–∏–≥—Ä–∞ –∫–∞–¥–∑—é–Ω—ã
    let score = 0;
    const game = document.getElementById('game');
    function spawn() {
      const k = document.createElement('div');
      k.className = 'kadzyun';
      k.style.left = Math.random()*240 + 'px';
      k.style.top = Math.random()*240 + 'px';
      k.onclick = () => {
        score += 10;
        document.getElementById('score').textContent = score;
        saveScore();
        k.remove();
      };
      game.appendChild(k);
      setTimeout(() => k.remove(), 3000);
    }
    setInterval(spawn, 800);

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Ç–æ–ø
    function saveScore() {
      const user = Telegram.WebApp.initDataUnsafe.user || {first_name:'–ê–Ω–æ–Ω–∏–º', username:'anon'};
      const name = user.username ? `@${user.username}` : user.first_name;
      const today = new Date().toDateString();
      let top = JSON.parse(localStorage.getItem('morikawa_ny_top') || '{}');
      if(!top[today]) top[today] = [];
      const existing = top[today].find(p => p.name === name);
      if(existing) existing.score = Math.max(existing.score, score);
      else top[today].push({name, score});
      top[today].sort((a,b)=>b.score-a.score);
      top[today] = top[today].slice(0,10);
      localStorage.setItem('morikawa_ny_top', JSON.stringify(top));
      updateTop();
      updateLeaderboard();
    }
    function updateTop() {
      const today = new Date().toDateString();
      let top = JSON.parse(localStorage.getItem('morikawa_ny_top') || '{}');
      const list = top[today] || [];
      document.getElementById('top').innerHTML = '<strong>üèÜ –¢–æ–ø —Å–µ–≥–æ–¥–Ω—è:</strong><br>' + 
        (list.length ? list.map((p,i)=>`${i+1}. ${p.name} ‚Äî ${p.score}`).join('<br>') : '–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ!');
    }
    updateTop();

    // –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    function updateLeaderboard() {
      const listEl = document.getElementById('leader-list');
      listEl.innerHTML = '';
      const today = new Date().toDateString();
      let top = JSON.parse(localStorage.getItem('morikawa_ny_top') || '{}');
      const list = top[today] || [];
      list.forEach((p,i) => {
        const li = document.createElement('li');
        li.innerHTML = `${i+1}. ${p.name} ‚Äî ${p.score} –æ—á–∫–æ–≤`;
        listEl.appendChild(li);
      });
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    function switchPage(page) {
      document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      if(page === 'leaderboard') updateLeaderboard();
      if(page === 'cards') {
        updateCollection();
        document.getElementById('daily-info').textContent = canOpenCase() ? '–ì–æ—Ç–æ–≤ –∫ –æ—Ç–∫—Ä—ã—Ç–∏—é!' : '–ó–∞–≤—Ç—Ä–∞ –Ω–æ–≤—ã–π –∫–µ–π—Å!';
      }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    function copyCoords() {
      navigator.clipboard.writeText('—Ä–æ–∑–æ–≤–∞—è –≤–µ—Ç–∫–∞:1700');
      Telegram.WebApp.showAlert('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
    }

    // –°–∏—Å—Ç–µ–º–∞ –∫–µ–π—Å–æ–≤
    const players = [  // –î–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã—Ö –∑–¥–µ—Å—å!
      { name: "miymyr4", username: "@miymyr4", rarity: "epic", image: "https://i.ebayimg.com/images/g/YkgAAOSwuIRliHe3/s-l1200.jpg", desc: "–ú—ç—Ä Morikawa üëë" },
      { name: "–°–∞–º—É—Ä–∞–π –í–æ–∏–Ω", username: "@samurai", rarity: "rare", image: "https://static.planetminecraft.com/files/image/minecraft/project/2024/639/17655076-minecraft-samurai_xl.webp", desc: "–ú–∞—Å—Ç–µ—Ä –∫–∞—Ç–∞–Ω—ã ‚öîÔ∏è" },
      { name: "–ù–∏–Ω–¥–∑—è –¢–µ–Ω–∏", username: "@ninja", rarity: "rare", image: "https://play-lh.googleusercontent.com/2piZA7eQqvsfnLLwyTW7X-mwOz3YHQvxtWQvTpZM6eKgiok5l7uvSXyhd4DHynx0IA=w526-h296-rw", desc: "–ù–µ–≤–∏–¥–∏–º—ã–π —É–±–∏–π—Ü–∞ üó°Ô∏è" },
      { name: "–°–∞–∫—É—Ä–∞ –ì–µ–π—à–∞", username: "@sakura", rarity: "common", image: "https://xforgeassets002.xboxlive.com/pf-namespace-b63a0803d3653643/6d0bf87c-bf5e-4076-afa6-c721d0fbe6bc/CherryBlossomVillage_Thumbnail_0.jpg", desc: "–•—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ —Å–∞–¥–æ–≤ üå∏" },
      { name: "–î—Ä–∞–∫–æ–Ω –û–Ω–∏", username: "@oni", rarity: "epic", image: "https://atlbrick.com/cdn/shop/files/FullSizeRender_7ec97597-7ae8-4544-b958-5b060f0b1b96.jpg?v=1705685166", desc: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Å—Ç—Ä–∞–∂ üêâ" },
      { name: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å –•—Ä–∞–º–æ–≤", username: "@builder", rarity: "common", image: "https://m.media-amazon.com/images/I/71GA++J9V1L._AC_SL1500_.jpg", desc: "–ú–∞—Å—Ç–µ—Ä –º–∞–ø-–∞—Ä—Ç–æ–≤ ‚õ©Ô∏è" }
    ];

    let collection = JSON.parse(localStorage.getItem('morikawa_collection') || '[]');
    const totalPlayers = players.length;

    function updateCollection() {
      document.getElementById('total-count').textContent = totalPlayers;
      document.getElementById('collected-count').textContent = collection.length;

      const collEl = document.getElementById('collection');
      collEl.innerHTML = '';
      players.forEach(p => {
        const div = document.createElement('div');
        div.className = 'collected-card' + (collection.includes(p.name) ? ' owned' : '');
        div.style.backgroundImage = `url('${p.image}')`;
        div.title = p.name + (collection.includes(p.name) ? ' ‚úì' : '');
        collEl.appendChild(div);
      });
    }

    function canOpenCase() {
      const last = localStorage.getItem('morikawa_last_case');
      const now = Date.now();
      if(!last || now - parseInt(last) > 86400000) return true;
      return false;
    }

    function openCase() {
      if(!canOpenCase()) {
        Telegram.WebApp.showAlert('–°–µ–≥–æ–¥–Ω—è –∫–µ–π—Å —É–∂–µ –æ—Ç–∫—Ä—ã—Ç! –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞–≤—Ç—Ä–∞ üéÅ');
        return;
      }

      // –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –∫–µ–π—Å–∞
      const caseModel = document.getElementById('case-model');
      caseModel.classList.add('opening');
      setTimeout(() => {
        caseModel.classList.remove('opening');
        // –î—Ä–æ–ø –∫–∞—Ä—Ç–æ—á–∫–∏
        const drop = players[Math.floor(Math.random() * players.length)];
        if(!collection.includes(drop.name)) collection.push(drop.name);
        localStorage.setItem('morikawa_collection', JSON.stringify(collection));
        localStorage.setItem('morikawa_last_case', Date.now().toString());

        document.getElementById('card-name').textContent = drop.name + ' (' + drop.username + ')';
        document.getElementById('card-rarity').textContent = drop.rarity.toUpperCase();
        document.getElementById('card-rarity').style.color = drop.rarity === 'epic' ? '#ff00ff' : drop.rarity === 'rare' ? '#00ff00' : '#bbb';
        document.getElementById('card-image').src = drop.image;
        document.getElementById('card-desc').textContent = drop.desc;
        document.getElementById('dropped-card').className = 'card-display rarity-' + drop.rarity;
        document.getElementById('drop-animation').style.display = 'block';

        // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç
        for(let i=0; i<50; i++) {
          const conf = document.createElement('div');
          conf.className = 'confetti';
          conf.style.left = Math.random()*300 + 'px';
          conf.style.top = Math.random()*400 + 'px';
          conf.style.background = ['#ff69b4', '#ffd700', '#00ff00'][Math.floor(Math.random()*3)];
          conf.style.animationDelay = Math.random()*1 + 's';
          document.getElementById('dropped-card').appendChild(conf);
          setTimeout(() => conf.remove(), 3000);
        }

        Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        updateCollection();
        document.getElementById('daily-info').textContent = '–ó–∞–≤—Ç—Ä–∞ –Ω–æ–≤—ã–π –∫–µ–π—Å!';
      }, 2000);  // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å shakeOpen
    }

    function closeDrop() {
      document.getElementById('drop-animation').style.display = 'none';
    }
  </script>
</body>
</html>
